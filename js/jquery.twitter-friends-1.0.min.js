/* 	Twitter Friends Widget v2.0
	Blog : http://www.moretechtips.net
	Project: http://code.google.com/p/twitter-friends-widget/
	Copyright 2012 [Mike @ moretechtips.net] 
	Licensed under the Apache License, Version 2.0 
	(the "License"); you may not use this file except in compliance with the License. 
	You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 
*/
(function(c){c.fn.twitterFriends=function(l){l=c.extend({},c.fn.twitterFriends.defaults,l);return this.each(function(){var f=[],h=-1,i=-1,e=c(this),g=null,j=null,k=null,a=l,s=function(b){b.users?(f=b.users,0!=f.length&&(!a.users_random||2>f.length/a.users_max?f.length>a.users_max&&(f.length=a.users_max):(b=Math.floor(f.length/a.users_max),b=Math.floor(Math.random()*b),f=f.slice(b*a.users_max,b*a.users_max+a.users_max)),a.users_reverse&&(f=f.reverse()),n(),g=c('<div class="tfw-users" style="'+(a.users_height?
"height:"+a.users_height+"px":"")+'"></div>'),k?g.insertAfter(k):g.prependTo(e),a.tweet&&(j=c('<div class="tfw-tweet" style="'+(a.tweet_height?"height:"+a.tweet_height+"px":"")+'"></div>').insertAfter(g)),m(),a.users_loaded&&a.users_loaded())):a.debug&&e.html('<b style="color:red">Error:'+(b.error?b.error:"unkown")+"</b>")},m=function(){g.html("");for(var b=0;b<f.length;b++){var d=f[b],o=a.user_link&&d.url?d.url:"http://twitter.com/"+d.screen_name,e=d.name+(d.status&&a.tweet?": "+d.status.text:""),
e=e.replace(/"/g,"&quot;").replace(/'/g,"&#39;");c('<a style="'+(a.user_animate?"display:none;":"")+"width:"+a.user_image+'px" href="'+o+'" title="'+e+'" target="_blank"><img src="'+d.profile_image_url+'" border="0" height="'+a.user_image+'" width="'+a.user_image+'"/>'+(a.user_name?"<i>"+d.name+"</i>":"")+"</a>").appendTo(g)}h=a.user_append?-1:c("a",g).length;p();i=-1;a.tweet&&q()},p=function(){h=a.user_append?h+1:h-1;var b=c("a:eq("+h+")",g);if(b.length){var d={};d[a.user_animate]="show";b.animate(d,
a.user_change,"linear",p)}else!a.tweet&&a.loop&&g.animate({opacity:1},a.user_swap,"linear",m)},q=function(){if(a.loop||!(i>=c("a",g).length-1))-1<i?c("div",j).fadeOut(a.tweet_change,r):r()},r=function(){for(var b=null,d=null;!d;){i++;if(i>=c("a",g).length){a.loop&&m();return}b=f[i];d=b.status}var o=a.user_link&&b.url?b.url:"http://twitter.com/"+b.screen_name,e=b.name;j.html('<div style="display:none;">'+(a.tweet_avatar?'<a class="avatar" href="'+o+'" title="'+e+'" target="_blank"><img src="'+b.profile_image_url+
'" height="'+a.tweet_image+'" width="'+a.tweet_image+'" border="0"/></a>':"")+'<span class="body">'+(a.tweet_author?'<strong><a href="'+o+'" title="'+e+'" target="_blank">'+b.screen_name+"</a></strong>":"")+'<span class="content">'+t(d.text)+'</span><span class="meta">'+(a.tweet_date?'<a class="date" href="http://twitter.com/'+b.screen_name+"/status/"+d.id_str+'" target="_blank">'+u(d.created_at)+"</a>":"")+"</span></span></div>");b={};b[a.tweet_animate]="show";c("div",j).animate(b,a.tweet_change,
"linear",v)},v=function(){c("div",j).animate({opacity:1},a.tweet_stay,"linear",q)},t=function(b){return b.replace(/\bhttps?\:\/\/\S+/gi,function(b){var a="",b=b.replace(/(\.*|\?*|\!*)$/,function(b,d){a=d;return""});return'<a class="link" href="'+b+'" target="_blank">'+(25<b.length?b.substr(0,24)+"...":b)+"</a>"+a}).replace(/\B\@([A-Z0-9_]{1,15})/gi,'@<a class="at" href="http://twitter.com/$1" target="_blank">$1</a>').replace(/\B\#([A-Z0-9_]+)/gi,'<a class="hashtag" href="http://search.twitter.com/search?q=%23$1" target="_blank">#$1</a>')},
u=function(b){/^(\w\w\w) (\w\w\w) (\d\d?) (\d\d?:\d\d?:\d\d?) ([\+\-]\d+) (\d\d\d\d)$/i.test(b)&&(b=b.replace(/^(\w\w\w) (\w\w\w) (\d\d?) (\d\d?:\d\d?:\d\d?) ([\+\-]\d+) (\d\d\d\d)$/i,"$1, $3 $2 $6 $4 $5"));var a=new Date,c=new Date;a.setTime(Date.parse(b));var e=c.getDate(),f=c.getMonth()+1,g=c.getFullYear(),i=c.getHours(),h=c.getMinutes(),c=c.getSeconds(),j=a.getDate(),k=a.getMonth()+1,l=a.getFullYear(),m=a.getHours(),n=a.getMinutes(),b=a.getSeconds();if(l==g&&k==f&&j==e){a=i-m;if(0<a)return a+
" hour"+(1<a?"s":"")+" ago";h-=n;if(0<h)return h+" minute"+(1<h?"s":"")+" ago";b=c-b;return b+" second"+(1<b?"s":"")+" ago"}return"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(",")[k-1]+" "+j+", "+l},w=function(b){k=c('<div class="tfw-header" style="'+(a.header_height?"height:"+a.header_height+"px":"")+'"></div>').prependTo(e);n();if(b.screen_name){var d='<a href="_tp_" target="_blank" align="left"><img src="_ti_" border="0" /><em>_tn_</em><var><i></i>Follow @_ts_</var><dfn>_fo_ followers</dfn></a>';
a.header_html&&(d=a.header_html);k.html(d.replace(/_tp_/g,"http://twitter.com/"+b.screen_name).replace(/_fr_/g,b.friends_count).replace(/_fo_/g,b.followers_count).replace(/_ti_/g,b.profile_image_url).replace(/_tn_/g,b.name).replace(/_ts_/g,b.screen_name));a.header_loaded&&a.header_loaded()}else a.debug&&k.html('<b style="color:red">Error:'+(b.error?b.error:"unkown")+"</b>")},x=function(a){for(var a=a.get(0).childNodes,d=0;d<a.length;d++){var e=a[d];if(8==e.nodeType&&e.nodeValue)return c.trim(e.nodeValue)}return""},
n=function(){a.width&&e.css("width",a.width+"px");var b=c(".tfw-info",e);b.text("Twitter Friends/Followers Widget");b.attr("href","http://www.moretechtips.net/");b.show().css("display","block")};(function(){var b=e.attr("data-options");b||(b=x(e));if(b){0>b.indexOf("{")&&(b="{"+b+"}");try{a=eval("("+b+")")}catch(d){e.html('<b style="color:red">Options error: '+d+"</b>");return}a=c.extend({},c.fn.twitterFriends.defaults,a)}!a.username&&a.debug&&e.html('<b style="color:red">Twitter username was not set!</b>');
a.header&&c.ajax({url:"http://api.twitter.com/1/users/show.json",data:{screen_name:a.username},success:w,dataType:"jsonp",cache:!0});c.ajax({url:a.friends?"http://api.twitter.com/1/statuses/friends.json":"http://api.twitter.com/1/statuses/followers.json",data:{screen_name:a.username,cursor:-1,include_entities:!1},success:s,dataType:"jsonp",cache:!0})})()})};c.fn.twitterFriends.defaults={debug:0,username:"",friends:0,width:0,users_max:20,users_random:0,users_reverse:0,users_height:0,users_loaded:null,
loop:0,user_link:0,user_image:48,user_name:1,user_animate:"opacity",user_change:100,user_swap:2E3,user_append:1,header:1,header_html:"",header_height:0,header_loaded:null,tweet:0,tweet_height:0,tweet_avatar:1,tweet_author:1,tweet_date:1,tweet_image:48,tweet_stay:5E3,tweet_change:200,tweet_animate:"opacity"}})(jQuery);jQuery(document).ready(function(){jQuery("div.twitter-friends").twitterFriends()});
